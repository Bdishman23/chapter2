library(rgbif)
library(plyr)

#' Query gbif to return latitude and longitude for members of a clade of interest
#'
#' @param query name of the clade of interest
#' @param rank the clade's rank (e.g. "genus")
#' @return A data frame (tibble) of key, scientific name, decimal latitude, and decimal longitude
#' @export

gbif_clade_query <- function (query, rank){
  key <- rgbif::name_suggest(q=query, rank=rank)$key[1]
  dat <- rgbif::occ_search(taxonKey=key, fields="minimal", limit=300)

  return(dat)
}


species <- c("Puma concolor", "Myrmecocystus mexicanus", "Ursus arctos")

#' Query gbif to return latitude and longitude for a vector of species
#'
#' @param species a vector of species names
#' @return A data frame (tibble) of key, scientific name, decimal latitude, and decimal longitude
#' @export

gbif_species_query <- function (species){
all.records <- data.frame()
for (species_index in seq_along(species)) {
all.records <- plyr::rbind.fill(all.records, rgbif::occ_search(scientificName = species[species_index], fields="minimal", limit = 300)$data)
}
return(all.records)
}




gbif_clade_query("fagales", "class")
